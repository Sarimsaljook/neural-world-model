stage:
  name: stage4_intuition
  entrypoint: nwm_core.train.stages.stage4_intuition

seed: 1337

paths:
  run_root: outputs/train/${stage.name}
  data_root: assets/training_data
  ckpt_root: ${paths.run_root}/checkpoints
  report_root: ${paths.run_root}/reports

configs:
  data:
    ssv2: ${configs.data.ssv2}

device:
  accelerator: cuda
  precision: bf16
  cudnn_benchmark: true

data:
  dataset: ${configs.data.ssv2}
  num_workers: 14
  pin_memory: true
  persistent_workers: true
  prefetch_factor: 4

train:
  max_steps: 120000
  eval_every: 2000
  ckpt_every: 5000
  log_every: 50
  grad_accum: 1
  batch_size: 18
  clip_grad_norm: 1.0

init:
  encoder_ckpt: outputs/train/stage1_encoder/checkpoints/last.pt
  compiler_ckpt: outputs/train/stage2_compiler/checkpoints/last.pt
  mechanisms_ckpt: outputs/train/stage3_mechanisms/checkpoints/last.pt
  strict: false

model:
  train_parts:
    encoder: false
    compiler: false
    mechanisms: false
    intuition: true
    memory: false
    planning: false

  intuition:
    horizon_s: 3.0
    calibration:
      enable: true
      temperature_init: 1.0

loss:
  weights:
    risk_bce: 1.0
    stability_bce: 1.0
    slip_bce: 0.5
    collision_bce: 0.75
    calibration_ece: 0.25

optim:
  name: adamw
  lr: 2.25e-4
  betas: [0.9, 0.95]
  wd: 0.02
  warmup_steps: 2000
  schedule: cosine
  min_lr: 1.0e-6

ema:
  enable: true
  decay: 0.9998

amp:
  enable: true

checkpoint:
  save_last: true
  save_best: true
  metric: val/loss
  mode: min
